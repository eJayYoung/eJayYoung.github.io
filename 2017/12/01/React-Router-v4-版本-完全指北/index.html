<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="stay hungry, stay foolish"><title>React Router v4 版本 完全指北 | 雪庐</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">React Router v4 版本 完全指北</h1><a id="logo" href="/.">雪庐</a><p class="description">逸杰的博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">React Router v4 版本 完全指北</h1><div class="post-meta">Dec 1, 2017<span> | </span><span class="category"><a href="/categories/翻译/">翻译</a></span></div><div class="post-content"><p>React Router v4 版本 极简入门<br><a id="more"></a></p>
<p><strong><a href="https://reacttraining.com/react-router/" target="_blank" rel="external">React Router</a> 已经成为“事实上”的React官方标准路由库。当你在一个多视图的React应用中来回切换，你需要一个路由来管理那些URL。React Router 专注于此，同步保持你应用的UI和URL。</strong></p>
<p>这个教程主要给你介绍React Router 的v4版本，以及你使用它可以做的大部分事情。</p>
<h2 id="开场白"><a href="#开场白" class="headerlink" title="开场白"></a>开场白</h2><p>React 是一个很流行的库，多用于创建在客户端渲染的单页应用(SPAs)。 一个SPA会有很多<strong>视图</strong>（也可以称为<strong>页面</strong>）,不像传统的多页应用，视图之间的跳转不应该导致整个页面被重新加载。相反，我们希望视图就在当前页面里渲染。那些习惯于多页应用的最终用户，期望在一个SPA中应该包含以下特性：</p>
<ul>
<li><p>应用中每个视图都应该有对应的唯一URL用来区分视图。以便用户可以在之后通过书签收藏的URL指向引用资源 - 例如：<code>www.example.com/products</code>。</p>
</li>
<li><p>浏览器的前进后退按钮应该正常工作。</p>
</li>
<li><p>动态生成的嵌套视图更应该有成对应的URL - 例如：<code>example.com/products/shoes/101</code>，101是产品id。</p>
</li>
</ul>
<p><strong>路由跳转</strong>是指在同步保持浏览器URL的过程中渲染页面中的视图。React Router 让你声明式的操作路由跳转。声明式路由方法，通过说“路由应该是这样的”，<span style="font-size: 1rem;">允许你控制应用中的数据流</span>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`<span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/about"</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;/</span>&gt;</span>`</div></pre></td></tr></table></figure>
<p>你可以把<code>&lt;Route&gt;</code>组件放在任意你想要路由渲染的地方。由于我们所需要接触的<code>&lt;Route&gt;</code>,<code>&lt;Link&gt;</code>以及其他React Router的API都只是组件，所以你可以非常方便的在React里使用路由。</p>
<p>写在开头。有一个常见的误区，大家都认为React Router是由facebook官方开发的一个路由解决方案。实际上，它是一个因其设计和简易性而流行的第三方库。如果你的需求只局限于路由的跳转，你可以无需太多麻烦，就可以从头开始实现一个自定义的路由。但是，了解React Router的基础知识可以让你更清楚的认识一个路由是怎么工作的。</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><img src="http://p0.qhimg.com/t01fc32820c51696f31.jpg" alt="React Router Logo"></p>
<p>本次教程分为几个部分。首先，我们使用npm安装好React和React Router，然后我们就开始React Router的基础部分。你将会看到React Router不同的代码示例的效果。本次教程涉及的例子包含：</p>
<ol>
<li><p>基本路由跳转</p>
</li>
<li><p>嵌套路由</p>
</li>
<li><p>带路径参数的嵌套路由</p>
</li>
<li><p>保护式路由</p>
</li>
</ol>
<p>主要围绕构建这些路由所涉及的概念进行讨论。这个项目的全部代码在<a href="https://github.com/blizzerand/react-router-v4-demo" target="_blank" rel="external">这个Github仓库</a>可以看到。当你进入一个单独的demo目录，执行<code>npm install</code>来安装依赖。要在本地服务器上运行这个应用，执行<code>npm start</code>，然后在浏览器打开<code>http://localhost:3000/</code>可以看到运行的demo。</p>
<p>让我们开始吧！</p>
<h2 id="安装-React-Router"><a href="#安装-React-Router" class="headerlink" title="安装 React Router"></a>安装 React Router</h2><p>假设你已经有一个React开发环境并已经运行了。如果没有，可以跳转到<a href="https://www.sitepoint.com/getting-started-react-jsx/" target="_blank" rel="external">React和JSX入门</a>。或者，你可以使用<a href="https://www.sitepoint.com/create-react-app/" target="_blank" rel="external">Create React App</a>来生成创建一个基本的React项目所需要的文件。这是Create React App生成的默认目录结构：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">react-routing-demo-v4</div><div class="line">   ├── .gitignore</div><div class="line">   ├── package.json</div><div class="line">   ├── public</div><div class="line">   │   ├── favicon.ico</div><div class="line">   │   ├── index.html</div><div class="line">   │   └── manifest.json</div><div class="line">   ├── README.md</div><div class="line">   ├── src</div><div class="line">   │   ├── App.css</div><div class="line">   │   ├── App.js</div><div class="line">   │   ├── App<span class="selector-class">.test</span><span class="selector-class">.js</span></div><div class="line">   │   ├── index.css</div><div class="line">   │   ├── index.js</div><div class="line">   │   ├── logo.svg</div><div class="line">   │   └── registerServiceWorker.js</div><div class="line">   └── yarn.lock</div></pre></td></tr></table></figure>
<p>React Router库包含三个包： <code>react-router</code>, <code>react-router-dom</code>, 和 <code>react-router-native</code>。<code>react-router</code>是路由的核心包，而其他两个是基于特定环境的。如果你在开发一个网站，你应该使用<code>react-router-dom</code>，如果你在移动应用的开发环境使用React Native，你应该使用<code>react-router-native</code>。</p>
<p>使用npm安装<code>react-router-dom</code>：</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`npm install --save react-router-dom`</div></pre></td></tr></table></figure>
<h2 id="React-Router-基础"><a href="#React-Router-基础" class="headerlink" title="React Router 基础"></a>React Router 基础</h2><p>下面是路由的例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;/</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/category"</span> <span class="attr">component</span>=<span class="string">&#123;Category&#125;/</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/login"</span> <span class="attr">component</span>=<span class="string">&#123;Login&#125;/</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/products"</span> <span class="attr">component</span>=<span class="string">&#123;Products&#125;/</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h3><p>像上面的例子，你需要一个<code>&lt;Router&gt;</code>组件和一些<code>&lt;Route&gt;</code>组件来创建一个基本的路由。由于我们创建的是一个基于浏览器的应用，我们可以从React Router API中使用这两种类型的路由：</p>
<ol>
<li><p><code>&lt;BrowserRouter&gt;</code></p>
</li>
<li><p><code>&lt;HashRouter&gt;</code></p>
</li>
</ol>
<p>它们之间主要的区别，可以在它们所创建的URL明显看出：</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &lt;BrowserRouter&gt;</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//example.com/about</span></div><div class="line"></div><div class="line"><span class="comment">// &lt;HashRouter&gt;</span></div><div class="line"><span class="symbol">http:</span><span class="comment">//example.com/#/about</span></div></pre></td></tr></table></figure>
<p><code>&lt;BrowserRouter&gt;</code>在两者中更为常用，原因是它使用了HTML5的history API来记录你的路由历史。而<code>&lt;HashRouter&gt;</code>则使用URL(<code>window.location.hash</code>)的hash部分来记录。如果你想兼容老式浏览器，你应该使用<code>&lt;HashRouter&gt;</code>。</p>
<p>使用<code>&lt;BrowserRouter&gt;</code>组件包裹App组件。</p>
<h4 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Import statements */</span></div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</div><div class="line"></div><div class="line"><span class="comment">/* App is the entry point to the React code.*/</span></div><div class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span>;</div><div class="line"></div><div class="line"><span class="comment">/* import BrowserRouter from 'react-router-dom' */</span></div><div class="line"><span class="keyword">import</span> &#123; BrowserRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">    &lt;BrowserRouter&gt;</div><div class="line">        &lt;App /&gt;</div><div class="line">    &lt;<span class="regexp">/BrowserRouter&gt;</span></div><div class="line"><span class="regexp">    , document.getElementById('root'));</span></div></pre></td></tr></table></figure>
<p>注意：Router组件只能有一个子元素。子元素可以是HTML - 例如div - 也可以是一个react组件。</p>
<p>要让React Router工作，你需要从<code>react-router-dom</code>库引入相关的API。这里，我在<code>index.js</code>引入了<code>BrowserRouter</code>，也从<code>App.js</code>引入了<code>App</code>组件。<code>App.js</code>，如你所猜想的，是React组件的入口。</p>
<p>上述代码给我们整个App组件创建了一个history实例。接下来正式介绍下history。</p>
<h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><blockquote>
<p><code>history</code>是一个让你轻松管理所有Javascript运行的会话记录的Javascript库。history提供了简洁的API，让你可以管理history堆栈，跳转，确认跳转，以及保持会话之间的状态。 - 来自<a href="https://github.com/ReactTraining/history" target="_blank" rel="external">React 培训文档</a></p>
</blockquote>
<p>每个router组件创建了一个history对象，用来记录当前路径(<code>history.location</code>)，上一步路径也存储在堆栈中。当前路径改变时，视图会重新渲染，给你一种跳转的感觉。当前路径又是如何改变的呢？history对象有<code>history.push()</code>和<code>history.replace()</code>这些方法来实现。当你点击<code>&lt;Link&gt;</code>组件会触发<code>history.push()</code>，使用<code>&lt;Redirect&gt;</code>则会调用<code>history.replace()</code>。其他方法 - 例如<code>history.goBack()</code>和<code>history.goForward()</code> - 用来根据页面的后退和前进来跳转history堆栈。</p>
<p>接下来，我们谈谈Links和Routes</p>
<h3 id="Links-and-Routes"><a href="#Links-and-Routes" class="headerlink" title="Links and Routes"></a>Links and Routes</h3><p><code>&lt;Route&gt;</code>是React Router里最重要的组件。若当前路径匹配route的路径，它会渲染对应的UI。理想来说，<code>&lt;Route&gt;</code>应该有一个叫<code>path</code>的prop，当路径名跟当前路径匹配才会渲染。</p>
<p>另一方面，<code>&lt;Link&gt;</code>用来跳转页面。可以类比HTML的锚元素。然而，使用锚链接会导致浏览器的刷新，这不是我们想要的。所以，我们可以使用<code>&lt;Link&gt;</code>来跳转至具体的URL，并且视图重新渲染不会导致浏览器刷新。</p>
<p>我们已经介绍了创建一个基本的路由需要的所有东西。让我们试一个吧。</p>
<h3 id="Demo-1-基础路由"><a href="#Demo-1-基础路由" class="headerlink" title="Demo 1: 基础路由"></a>Demo 1: 基础路由</h3><h4 id="src-App-js"><a href="#src-App-js" class="headerlink" title="src/App.js"></a>src/App.js</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">/* Import statements */</div><div class="line">import React, &#123; Component &#125; from 'react';</div><div class="line">import &#123; Link, Route, Switch &#125; from 'react-router-dom';</div><div class="line"></div><div class="line">/* Home component */</div><div class="line">const Home = () =&gt; (</div><div class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">)</div><div class="line"></div><div class="line">/* Category component */</div><div class="line">const Category = () =&gt; (</div><div class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Category<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">)</div><div class="line"></div><div class="line">/* Products component */</div><div class="line">const Products = () =&gt; (</div><div class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Products<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">)</div><div class="line"></div><div class="line">/* App component */</div><div class="line">class App extends React.Component &#123;</div><div class="line">  render() &#123;</div><div class="line">    return (</div><div class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">nav</span> <span class="attr">className</span>=<span class="string">"navbar navbar-light"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line"></div><div class="line">           /* Link components are used for linking to other views */</div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Homes<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/category"</span>&gt;</span>Category<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/products"</span>&gt;</span>Products<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"></div><div class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">         <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div><div class="line"></div><div class="line">          /* Route components are rendered if the path prop matches the current URL */</div><div class="line">           <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;/</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/category"</span> <span class="attr">component</span>=<span class="string">&#123;Category&#125;/</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/products"</span> <span class="attr">component</span>=<span class="string">&#123;Products&#125;/</span>&gt;</span></div><div class="line"></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们在<code>App.js</code>里定义了 Home，Category，和Products组件。尽管目前看起来没问题，当组件变得越来越臃肿，最好将每个组件分成单独的文件。根据经验，如果组件代码超过了10行，我通常会给它创建一个新的文件。从第二个demo开始，我会将<code>App.js</code>里面越来越多的组件分成单独的文件。</p>
<p>在App组件中，我们写了路由跳转的逻辑。 <code>&lt;Route&gt;</code>的路径与当前路径匹配，对应组件就会被渲染。对应渲染的组件传给了第二个prop–<code>component</code>。</p>
<p>在这里，<code>/</code>同时匹配<code>/</code>和<code>/category</code>。因此，所有路由都匹配并被渲染。我们该如何避免呢？应该给 <code>path=&#39;/&#39;</code>的路由传递<code>exact= {true}</code>props：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`<span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span>=<span class="string">&#123;true&#125;</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;/</span>&gt;</span>`</div></pre></td></tr></table></figure>
<p>若只想要路由在路径完全相同时渲染，你就可以使用<code>exact</code>props。</p>
<h2 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h2><p>创建嵌套路由之前，我们需要更深入的理解<code>&lt;Route&gt;</code>如何运行。开始吧。</p>
<p><code>&lt;Route&gt;</code>有三个可以用来定义要渲染内容的props：</p>
<ul>
<li><p><strong>component</strong>.在上面我们已经看到了。当URL匹配时，router会将传递的组件使用<code>React.createElement</code>来生成一个React元素。</p>
</li>
<li><p><strong>render</strong>. 适合行内渲染。在当前路径匹配路由路径时，<code>render</code>prop期望一个函数返回一个元素。</p>
</li>
<li><p><strong>children</strong>.<code>children</code>prop跟<code>render</code>很类似，也期望一个函数返回一个React元素。然而，不管路径是否匹配，children都会渲染。</p>
</li>
</ul>
<h3 id="Path-and-match"><a href="#Path-and-match" class="headerlink" title="Path and match"></a>Path and match</h3><p><strong>path</strong>用来标识路由匹配的URL部分。React Router使用了Path-to-RegExp库将路径字符串转为正则表达式。然后正则表达式会匹配当前路径。</p>
<p>当路由路径和当前路径成功匹配，会生成一个对象，我们叫它<strong>match</strong>。match对象有更多关于URL和path的信息。这些信息可以通过它的属性获取，如下所示：</p>
<ul>
<li><p><code>match.url</code>.返回URL匹配部分的字符串。对于创建嵌套的<code>&lt;Link&gt;</code>很有用。</p>
</li>
<li><p><code>match.path</code>.返回路由路径字符串 - 就是<code>&lt;Route path=&quot;&quot;&gt;</code>。将用来创建嵌套的<code>&lt;Route&gt;</code>。</p>
</li>
<li><p><code>match.isExact</code>.返回布尔值，如果准确（没有任何多余字符）匹配则返回true。</p>
</li>
<li><p><code>match.params</code>.返回一个对象包含Path-to-RegExp包从URL解析的键值对。</p>
</li>
</ul>
<p>现在我们完全了解了<code>&lt;Route&gt;</code>，开始创建一个嵌套路由吧。</p>
<h3 id="Switch组件"><a href="#Switch组件" class="headerlink" title="Switch组件"></a>Switch组件</h3><p>在我们开始示例代码签，我想给你介绍下<code>&lt;Switch&gt;</code>组件。当一起使用多个<code>&lt;Route&gt;</code>时，所有匹配的routes都会被渲染。根据demo1的代码，我添加一个新的route来验证为什么<code>&lt;Switch&gt;</code>很有用。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;/</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/products"</span> <span class="attr">component</span>=<span class="string">&#123;Products&#125;/</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/category"</span> <span class="attr">component</span>=<span class="string">&#123;Category&#125;/</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/:id"</span> <span class="attr">render</span> = <span class="string">&#123;()</span>=&gt;</span> (<span class="tag">&lt;<span class="name">p</span>&gt;</span> I want this text to show up for all routes other than '/', '/products' and '/category' <span class="tag">&lt;/<span class="name">p</span>&gt;</span>)&#125;/&gt;</div></pre></td></tr></table></figure>
<p>当URL为<code>/products</code>，所有匹配<code>/products</code>路径的route都会被渲染。所以，那个path为<code>：id</code>的<code>&lt;Route&gt;</code>会跟着<code>Products</code>组件一块渲染。设计就是如此。但是，若这不是你想要的结果，你应该给你的routes添加<code>&lt;Switch&gt;</code>组件。有<code>&lt;Switch&gt;</code>组件的话，只有第一个匹配路径的子<code>&lt;Route&gt;</code>会渲染。</p>
<h3 id="Demo-2-嵌套路由"><a href="#Demo-2-嵌套路由" class="headerlink" title="Demo 2: 嵌套路由"></a>Demo 2: 嵌套路由</h3><p>之前，我们给<code>/</code>, <code>/category</code> and <code>/products</code>创建了路由。但如果我们想要<code>/category/shoes</code>这种形式的URL呢？</p>
<h4 id="src-App-js-1"><a href="#src-App-js-1" class="headerlink" title="src/App.js"></a>src/App.js</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">import React, &#123; Component &#125; from 'react';</div><div class="line">import &#123; Link, Route, Switch &#125; from 'react-router-dom';</div><div class="line">import Category from './Category';</div><div class="line"></div><div class="line">class App extends Component &#123;</div><div class="line">  render() &#123;</div><div class="line"></div><div class="line">    return (</div><div class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">nav</span> <span class="attr">className</span>=<span class="string">"navbar navbar-light"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>Homes<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/category"</span>&gt;</span>Category<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/products"</span>&gt;</span>Products<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;/</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/category"</span> <span class="attr">component</span>=<span class="string">&#123;Category&#125;/</span>&gt;</span></div><div class="line">       <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/products"</span> <span class="attr">component</span>=<span class="string">&#123;Products&#125;/</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">export default App;</div><div class="line"></div><div class="line">/* Code for Home and Products component omitted for brevity */</div></pre></td></tr></table></figure>
<p>不像React Router之前的版本，在版本4中，嵌套的<code>&lt;Route&gt;</code>最好放在父元素里面。所以，Category组件就是这里的父组件，我们将在父组件中定义<code>category/:name</code>路由。</p>
<h4 id="src-Category-jsx"><a href="#src-Category-jsx" class="headerlink" title="src/Category.jsx"></a>src/Category.jsx</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; Link, Route &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> Category = <span class="function">(<span class="params">&#123; match &#125;</span>) =&gt;</span> &#123;</div><div class="line"><span class="keyword">return</span>( &lt;div&gt; &lt;ul&gt;</div><div class="line">    &lt;li&gt;&lt;Link to=&#123;`$&#123;match.url&#125;/shoes`&#125;&gt;Shoes&lt;/Link&gt;&lt;/li&gt;</div><div class="line">    &lt;li&gt;&lt;Link to=&#123;`$&#123;match.url&#125;/boots`&#125;&gt;Boots&lt;/Link&gt;&lt;/li&gt;</div><div class="line">    &lt;li&gt;&lt;Link to=&#123;`$&#123;match.url&#125;/footwear`&#125;&gt;Footwear&lt;/Link&gt;&lt;/li&gt;</div><div class="line"></div><div class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></div><div class="line">  &lt;Route path=&#123;`$&#123;match.path&#125;/:name`&#125; render= &#123;(&#123;match&#125;) =&gt;( &lt;div&gt; &lt;h3&gt; &#123;match.params.name&#125; &lt;/h3&gt;&lt;/div&gt;)&#125;/&gt;</div><div class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</span></div><div class="line"><span class="xml">&#125;</span></div><div class="line"><span class="xml">export default Category;</span></div></pre></td></tr></table></figure>
<p>首先，我们给嵌套路由定义了一些Link。之前提到过，<code>match.url</code>用来构建嵌套链接，<code>match.path</code>用来构建嵌套路由。如果你对match有不理解的概念，<code>console.log(match)</code>会提供一些有用的信息来帮助你了解它。</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=</span></span><span class="template-variable">&#123;`$&#123;match.path&#125;</span><span class="xml"><span class="tag">/<span class="attr">:name</span>`&#125;</span></span></div><div class="line"><span class="xml">  render= </span><span class="template-variable">&#123;(&#123;match&#125;</span><span class="xml">) =&gt;( <span class="tag">&lt;<span class="name">div</span>&gt;</span> <span class="tag">&lt;<span class="name">h3</span>&gt;</span> </span><span class="template-variable">&#123;match.params.name&#125;</span><span class="xml"> <span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>)&#125;/&gt;</span></div></pre></td></tr></table></figure>
<p>这是我们首次尝试动态路由。不同于硬编码路由，我们给pathname使用了变量。<code>:name</code>是路径参数，获取<code>category/</code>之后到下一条斜杠之间的所有内容。所以，类似<code>products/running-shoes</code>的路径名会生成如下的一个<code>params</code>对象：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attribute">name</span>: <span class="string">'running-shoes'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>参数可以通过<code>match.params</code>或<code>props.match.params</code>来获取，取决于传递哪种props。另外有趣的是我们使用了<code>render</code>prop。<code>render</code> props非常适合行内函数，这样不需要单独拆分组件。</p>
<h3 id="Demo-3-带Path参数的嵌套路由"><a href="#Demo-3-带Path参数的嵌套路由" class="headerlink" title="Demo 3: 带Path参数的嵌套路由"></a>Demo 3: 带Path参数的嵌套路由</h3><p>我们让事情变得再复杂一些，可以吗？一个真实的路由应该是根据数据，然后动态展示。假设我们获取了从服务端API返回的product数据，如下所示。</p>
<h4 id="src-Products-jsx"><a href="#src-Products-jsx" class="headerlink" title="src/Products.jsx"></a>src/Products.jsx</h4><figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> productData = [</div><div class="line">&#123;</div><div class="line">  <span class="attribute">id:</span><span class="string"> 1,</span></div><div class="line"><span class="string">  name</span>: <span class="string">'NIKE Liteforce Blue Sneakers'</span>,</div><div class="line">  <span class="attribute">description</span>: <span class="string">'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin molestie.'</span>,</div><div class="line">  <span class="attribute">status</span>: <span class="string">'Available'</span></div><div class="line"></div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">  <span class="attribute">id:</span><span class="string"> 2,</span></div><div class="line"><span class="string">  name</span>: <span class="string">'Stylised Flip Flops and Slippers'</span>,</div><div class="line">  <span class="attribute">description</span>: <span class="string">'Mauris finibus, massa eu tempor volutpat, magna dolor euismod dolor.'</span>,</div><div class="line">  <span class="attribute">status</span>: <span class="string">'Out of Stock'</span></div><div class="line"></div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">  <span class="attribute">id:</span><span class="string"> 3,</span></div><div class="line"><span class="string">  name</span>: <span class="string">'ADIDAS Adispree Running Shoes'</span>,</div><div class="line">  <span class="attribute">description</span>: <span class="string">'Maecenas condimentum porttitor auctor. Maecenas viverra fringilla felis, eu pretium.'</span>,</div><div class="line">  <span class="attribute">status</span>: <span class="string">'Available'</span></div><div class="line">&#125;,</div><div class="line">&#123;</div><div class="line">  <span class="attribute">id:</span><span class="string"> 4,</span></div><div class="line"><span class="string">  name</span>: <span class="string">'ADIDAS Mid Sneakers'</span>,</div><div class="line">  <span class="attribute">description</span>: <span class="string">'Ut hendrerit venenatis lacus, vel lacinia ipsum fermentum vel. Cras.'</span>,</div><div class="line">  <span class="attribute">status</span>: <span class="string">'Out of Stock'</span></div><div class="line">&#125;,</div><div class="line"></div><div class="line">];</div></pre></td></tr></table></figure>
<p>我们需要根据下面这些路径创建路由：</p>
<ul>
<li><p><code>/products</code>. 这个路径应该展示产品列表。</p>
</li>
<li><p><code>/products/:productId</code>.如果产品有<code>:productId</code>，这个页面应该展示该产品的数据，如果没有，就该展示一个错误信息。</p>
</li>
</ul>
<h4 id="src-Products-jsx-1"><a href="#src-Products-jsx-1" class="headerlink" title="src/Products.jsx"></a>src/Products.jsx</h4><figure class="highlight dust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="xml">/* Import statements have been left out for code brevity */</span></div><div class="line"><span class="xml"></span></div><div class="line"><span class="xml">const Products = (</span><span class="template-variable">&#123; match &#125;</span><span class="xml">) =&gt; </span><span class="template-variable">&#123;</span></div><div class="line"><span class="template-variable"></span></div><div class="line"><span class="template-variable">   const productsData = [</span></div><div class="line"><span class="template-variable">    &#123;</span></div><div class="line"><span class="template-variable">        id: 1,</span></div><div class="line"><span class="template-variable">        name: 'NIKE Liteforce Blue Sneakers',</span></div><div class="line"><span class="template-variable">        description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin molestie.',</span></div><div class="line"><span class="template-variable">        status: 'Available'</span></div><div class="line"><span class="template-variable"></span></div><div class="line"><span class="template-variable">    &#125;</span><span class="xml">,</span></div><div class="line"><span class="xml"></span></div><div class="line"><span class="xml">    //Rest of the data has been left out for code brevity</span></div><div class="line"><span class="xml"></span></div><div class="line"><span class="xml">];</span></div><div class="line"><span class="xml"> /* Create an array of `<span class="tag">&lt;<span class="name">li</span>&gt;</span>` items for each product</span></div><div class="line"><span class="xml">  var linkList = productsData.map( (product) =&gt; </span><span class="template-variable">&#123;</span></div><div class="line"><span class="template-variable">    return(</span></div><div class="line"><span class="template-variable">      &lt;li&gt;</span></div><div class="line"><span class="template-variable">        &lt;Link to=&#123;`$&#123;match.url&#125;</span><span class="xml">/$</span><span class="template-variable">&#123;product.id&#125;</span><span class="xml">`&#125;&gt;</span></div><div class="line"><span class="xml">          </span><span class="template-variable">&#123;product.name&#125;</span><span class="xml"></span></div><div class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></div><div class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></div><div class="line"><span class="xml">      )</span></div><div class="line"><span class="xml"></span></div><div class="line"><span class="xml">    &#125;)</span></div><div class="line"><span class="xml"></span></div><div class="line"><span class="xml">  return(</span></div><div class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line"><span class="xml">         <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line"><span class="xml">           <span class="tag">&lt;<span class="name">h3</span>&gt;</span> Products<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></div><div class="line"><span class="xml">           <span class="tag">&lt;<span class="name">ul</span>&gt;</span> </span><span class="template-variable">&#123;linkList&#125;</span><span class="xml"> <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></div><div class="line"><span class="xml">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line"><span class="xml"></span></div><div class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=</span></span><span class="template-variable">&#123;`$&#123;match.url&#125;</span><span class="xml"><span class="tag">/<span class="attr">:productId</span>`&#125;</span></span></div><div class="line"><span class="xml">            render=</span><span class="template-variable">&#123; (props) =&gt; &lt;Product data= &#123;productsData&#125;</span><span class="xml"> </span><span class="template-variable">&#123;...props&#125;</span><span class="xml"> /&gt;&#125;/&gt;</span></div><div class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=</span></span><span class="template-variable">&#123;match.url&#125;</span><span class="xml"><span class="tag"></span></span></div><div class="line"><span class="xml">            render=</span><span class="template-variable">&#123;() =&gt; (</span></div><div class="line"><span class="template-variable">            &lt;div&gt;Please <span class="keyword">select</span> a product.&lt;/div&gt;</span></div><div class="line"><span class="template-variable">            )&#125;</span><span class="xml"></span></div><div class="line"><span class="xml">        /&gt;</span></div><div class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></div><div class="line"><span class="xml">  )</span></div><div class="line"><span class="xml">&#125;</span></div></pre></td></tr></table></figure>
<p>首先，我们通过<code>productsData.id</code>创建一列<code>&lt;Links&gt;</code>，并把它存储在<code>linkList</code>。路由从路径字符串根据匹配的对应产品id获取参数。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">match.url</span>&#125;/<span class="attr">:productId</span>`&#125;</span></div><div class="line"><span class="tag">  <span class="attr">render</span>=<span class="string">&#123;</span> (<span class="attr">props</span>) =&gt;</span> <span class="tag">&lt;<span class="name">Product</span> <span class="attr">data</span>= <span class="string">&#123;productsData&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span>&#125;/&gt;</div></pre></td></tr></table></figure>
<p>你可能期望使用<code>component = { Product }</code>来替代行内render函数。问题是，我们不仅需要<code>productsData</code>，并顺带把剩余prop也传给Product组件。尽管你还有其他方法，不过我觉的这是最简单的方法了。<code>{...props}</code>使用ES6的<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Operators/Spread_operator" target="_blank" rel="external">扩展运算符</a> 将所有prop传给组件。</p>
<p>这是Product组件的代码。</p>
<h4 id="src-Product-jsx"><a href="#src-Product-jsx" class="headerlink" title="src/Product.jsx"></a>src/Product.jsx</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* Import statements have been left out for code brevity */</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> Product = <span class="function">(<span class="params">&#123;match,data&#125;</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">var</span> product= data.find(<span class="function"><span class="params">p</span> =&gt;</span> p.id == match.params.productId);</div><div class="line">  <span class="keyword">var</span> productData;</div><div class="line"></div><div class="line">  <span class="keyword">if</span>(product)</div><div class="line">    productData = <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span> &#123;product.name&#125; <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></div><div class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;product.description&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></div><div class="line"><span class="xml">      <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></div><div class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;product.status&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span>  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  <span class="keyword">else</span></div><div class="line">    productData = <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span> Sorry. Product doesnt exist <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;div&gt;</div><div class="line">         &#123;productData&#125;</div><div class="line">      &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp">    &lt;/</span>div&gt;</div><div class="line">  )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>find</code>方法用来查找数组中对象的id属性等于<code>match.params.productId</code>。如果product存在，<code>productData</code>就会展示，如果不存在，“Product不存在”的信息就会被渲染。</p>
<h2 id="保护式路由"><a href="#保护式路由" class="headerlink" title="保护式路由"></a>保护式路由</h2><p>最后一个demo，我们将围绕保护式路由的技术进行讨论。那么，如果有人想进入<code>/admin</code>页面，他们会被要求先登录。然而，在我们保护路由之前还需要考虑一些事情。</p>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>类似服务端重定向，<code>&lt;Redirect&gt;</code>会将history堆栈的当前路径替换为新路径。新路径通过<code>to</code>prop传递。这是如何使用<code>&lt;Redirect&gt;</code>：</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`&lt;Redirect <span class="keyword">to</span>=&#123;&#123;pathname: <span class="string">'/login'</span>, state: &#123;from: props.location&#125;&#125;&#125;`</div></pre></td></tr></table></figure>
<p>如果有人已经注销了账户，想进入<code>/admin</code>页面，他们会被重定向到<code>/login</code>页面。当前路径的信息是通过state传递的，若用户信息验证成功，用户会被重定向回初始路径。在子组件中，你可以通过<code>this.props.location.state</code>获取state的信息。</p>
<h3 id="自定义路由"><a href="#自定义路由" class="headerlink" title="自定义路由"></a>自定义路由</h3><p>自定义路由最适合描述组件里嵌套的路由。如果我们需要确定一个路由是否应该渲染，最好的方法是写个自定义组件。下面是通过其他路由来定义自定义路由。</p>
<h4 id="src-App-js-2"><a href="#src-App-js-2" class="headerlink" title="src/App.js"></a>src/App.js</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/* Add the PrivateRoute component to the existing Routes */</div><div class="line"><span class="tag">&lt;<span class="name">Switch</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> <span class="attr">data</span>=<span class="string">&#123;data&#125;/</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/category"</span> <span class="attr">component</span>=<span class="string">&#123;Category&#125;/</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/login"</span> <span class="attr">component</span>=<span class="string">&#123;Login&#125;/</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">PrivateRoute</span> <span class="attr">authed</span>=<span class="string">&#123;fakeAuth.isAuthenticated&#125;</span> <span class="attr">path</span>=<span class="string">'/products'</span> <span class="attr">component</span> = <span class="string">&#123;Products&#125;</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></div></pre></td></tr></table></figure>
<p>若用户已登录，<code>fakeAuth.isAuthenticated</code>返回true，反之亦然。</p>
<p>这是PrivateRoute的定义。</p>
<h4 id="src-App-js-3"><a href="#src-App-js-3" class="headerlink" title="src/App.js"></a>src/App.js</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* PrivateRoute component definition */</span></div><div class="line">const PrivateRoute = (&#123;<span class="string">component:</span> Component, authed, ...rest&#125;) =&gt; &#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    &lt;Route</div><div class="line">      &#123;...rest&#125;</div><div class="line">      render=&#123;(props) =&gt; authed === <span class="literal">true</span></div><div class="line">        ? &lt;Component &#123;...props&#125; /&gt;</div><div class="line">        : &lt;Redirect to=&#123;&#123;<span class="string">pathname:</span> <span class="string">'/login'</span>, <span class="string">state:</span> &#123;<span class="string">from:</span> props.location&#125;&#125;&#125; <span class="regexp">/&gt;&#125; /</span>&gt;</div><div class="line">  )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果用户已登录，路由将渲染Admin组件。否则，用户将重定义到 <code>/login</code>登录页面。这样做的好处是，定义更明确，而且<code>PrivateRoute</code>可以复用。</p>
<p>最后，下面是Login组件的代码：</p>
<h4 id="src-Login-jsx"><a href="#src-Login-jsx" class="headerlink" title="src/Login.jsx"></a>src/Login.jsx</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="keyword">super</span>();</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.state = &#123;</div><div class="line">      redirectToReferrer: <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">    <span class="comment">// binding 'this'</span></div><div class="line">    <span class="keyword">this</span>.login = <span class="keyword">this</span>.login.bind(<span class="keyword">this</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  login() &#123;</div><div class="line"></div><div class="line">    fakeAuth.authenticate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">redirectToReferrer</span>: <span class="literal">true</span> &#125;)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">const</span> &#123; <span class="keyword">from</span> &#125; = <span class="keyword">this</span>.props.location.state || &#123; <span class="attr">from</span>: &#123; <span class="attr">pathname</span>: <span class="string">'/'</span> &#125; &#125;</div><div class="line">    <span class="keyword">const</span> &#123; redirectToReferrer &#125; = <span class="keyword">this</span>.state;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (redirectToReferrer) &#123;</div><div class="line">      <span class="keyword">return</span> (</div><div class="line">        &lt;Redirect to=&#123;<span class="keyword">from</span>&#125; /&gt;</div><div class="line">      )</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;div&gt;</div><div class="line">        &lt;p&gt;You must log <span class="keyword">in</span> to view the page at &#123;<span class="keyword">from</span>.pathname&#125;&lt;<span class="regexp">/p&gt;</span></div><div class="line"><span class="regexp">        &lt;button onClick=&#123;this.login&#125;&gt;Log in&lt;/</span>button&gt;</div><div class="line">      &lt;<span class="regexp">/div&gt;</span></div><div class="line"><span class="regexp">    )</span></div><div class="line"><span class="regexp">  &#125;</span></div><div class="line"><span class="regexp">&#125;</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">/</span>* A fake authentication <span class="function"><span class="keyword">function</span> */</span></div><div class="line"><span class="function"><span class="title">export</span> <span class="title">const</span> <span class="title">fakeAuth</span> = </span>&#123;</div><div class="line"></div><div class="line">  isAuthenticated: <span class="literal">false</span>,</div><div class="line">  authenticate(cb) &#123;</div><div class="line">    <span class="keyword">this</span>.isAuthenticated = <span class="literal">true</span></div><div class="line">     setTimeout(cb, <span class="number">100</span>)</div><div class="line">  &#125;,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面这行是<a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" target="_blank" rel="external">对象的解构赋值</a>的示例，es6的特性之一。</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`const &#123; <span class="keyword">from</span> &#125; = this.props.location.<span class="keyword">state</span> || &#123; <span class="keyword">from</span>: &#123; pathname: '/' &#125; &#125;`</div></pre></td></tr></table></figure>
<p>让我们把所有片段拼凑到一块，好吗？这是我们使用React Router创建的应用最终效果：</p>
<h3 id="Demo-4-保护式路由"><a href="#Demo-4-保护式路由" class="headerlink" title="Demo 4: 保护式路由"></a>Demo 4: 保护式路由</h3><p><a href="https://codesandbox.io/s/nn8x24vm60?from-embed" target="_blank" rel="external">点击此查看在线demo</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>如你在本文中所看到的，React Router是一个帮助React构建更完美，更声明式的路由库。不像React Router之前的版本，在v4中，一切就“只是组件”。而且，新的设计模式也更完美的使用React的构建方式来实现。</p>
<p>在本次教程中，我们学到了：</p>
<ul>
<li><p>如何配置和安装React Router</p>
</li>
<li><p>基础版路由，和一些基础组件，例如<code>&lt;Router&gt;</code>, <code>&lt;Route&gt;</code>和<code>&lt;Link&gt;</code></p>
</li>
<li><p>如何构建一个有导航功能的极简路由和嵌套路由</p>
</li>
<li><p>如何根据路径参数构建动态路由</p>
</li>
</ul>
<p>最后，我们还学习了一些高级路由技巧，用来创建保护式路由的最终demo。</p>
<p>感谢作者： <a href="https://www.sitepoint.com/author/manjunathm/" target="_blank" rel="external">Manjunath M</a><br><a href="https://github.com/blizzerand" target="_blank" rel="external"></a></p>
</div><div class="tags"><a href="/tags/React-Router/">React Router</a></div><div class="post-nav"><a href="/2017/12/01/一份来自Treebo-的-React-与-Preact-PWA-性能分析报告/" class="next">一份来自Treebo 的 React 与 Preact PWA 性能分析报告</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="ejayyoung.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/翻译/">翻译</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/React/" style="font-size: 15px;">React</a> <a href="/tags/Reflux/" style="font-size: 15px;">Reflux</a> <a href="/tags/UX/" style="font-size: 15px;">UX</a> <a href="/tags/PWA/" style="font-size: 15px;">PWA</a> <a href="/tags/React-Router/" style="font-size: 15px;">React Router</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/01/React-Router-v4-版本-完全指北/">React Router v4 版本 完全指北</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/01/一份来自Treebo-的-React-与-Preact-PWA-性能分析报告/">一份来自Treebo 的 React 与 Preact PWA 性能分析报告</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/09/下划线是否破坏可读性？-UX-Booth/">下划线是否破坏可读性？ | UX Booth [译文]</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/reflux-startup/">Reflux 入门 TodoList</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/Page-Visibility-API/">Page Visibility API</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">雪庐.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>